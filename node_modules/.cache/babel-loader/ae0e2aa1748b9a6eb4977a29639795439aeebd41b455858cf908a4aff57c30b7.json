{"ast":null,"code":"var _jsxFileName = \"/Users/mdkhalidhossain/CST/p2p-exchange/client/src/components/ChatModal.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatModal = ({\n  order,\n  user,\n  onClose\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [socket, setSocket] = useState(null);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [connectionError, setConnectionError] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef(null);\n  const messagesEndRef = useRef(null);\n  useEffect(() => {\n    // Initialize socket connection\n    const newSocket = io('http://localhost:50000', {\n      transports: ['websocket', 'polling']\n    });\n    newSocket.on('connect', () => {\n      console.log('ðŸ”µ Socket connected:', newSocket.id);\n      setConnectionError('');\n    });\n    newSocket.on('connect_error', error => {\n      console.error('ðŸ”´ Socket connection error:', error);\n      setConnectionError('Failed to connect to chat server');\n    });\n    newSocket.on('disconnect', reason => {\n      console.log('ðŸ”´ Socket disconnected:', reason);\n    });\n    setSocket(newSocket);\n\n    // Load chat messages\n    loadMessages();\n\n    // Join order room after connection is established\n    if (newSocket.connected) {\n      joinOrderRoom(newSocket);\n    } else {\n      newSocket.on('connect', () => {\n        joinOrderRoom(newSocket);\n      });\n    }\n\n    // Listen for new messages\n    newSocket.on('receive_message', message => {\n      console.log('ðŸ’¬ New message received:', message);\n      setMessages(prev => [...prev, message]);\n    });\n\n    // Listen for typing indicators\n    newSocket.on('user_typing', data => {\n      console.log('âŒ¨ï¸ User typing:', data);\n      setTypingUsers(prev => {\n        if (!prev.find(user => user.userId === data.userId)) {\n          return [...prev, data];\n        }\n        return prev;\n      });\n    });\n    newSocket.on('user_stop_typing', data => {\n      console.log('âŒ¨ï¸ User stopped typing:', data);\n      setTypingUsers(prev => prev.filter(user => user.userId !== data.userId));\n    });\n    return () => {\n      console.log('ðŸ”´ Cleaning up socket connection');\n      newSocket.disconnect();\n    };\n  }, [order.id]);\n  const joinOrderRoom = socket => {\n    console.log('ðŸŸ¡ Joining order room:', order.id);\n    socket.emit('join_order', order.id);\n  };\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, typingUsers]);\n  const loadMessages = async () => {\n    try {\n      console.log('ðŸŸ¡ Loading messages for order:', order.id);\n      const response = await axios.get(`http://localhost:50000/api/chat/messages/${order.id}`);\n      console.log('ðŸ“¨ Loaded messages:', response.data);\n\n      // Parse file_data from JSON string\n      const messagesWithFiles = response.data.map(message => ({\n        ...message,\n        file_data: message.file_data ? JSON.parse(message.file_data) : null\n      }));\n      setMessages(messagesWithFiles);\n    } catch (error) {\n      console.error('ðŸ”´ Error loading messages:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  const handleFileUpload = async file => {\n    if (!file) return;\n    setUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n      console.log('ðŸ“¤ Uploading file:', file.name);\n      const uploadResponse = await axios.post('http://localhost:50000/api/upload', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      console.log('ðŸŸ¢ File uploaded:', uploadResponse.data);\n\n      // Send file message via socket\n      if (socket && socket.connected) {\n        const messageData = {\n          orderId: order.id,\n          senderId: user.id,\n          senderName: user.name,\n          message: file.name,\n          messageType: 'file',\n          file: uploadResponse.data.file\n        };\n        console.log('ðŸ“¤ Sending file message:', messageData);\n        socket.emit('send_message', messageData);\n      }\n    } catch (error) {\n      console.error('ðŸ”´ File upload error:', error);\n      alert('Failed to upload file. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n  const handleFileSelect = e => {\n    const file = e.target.files[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n    // Reset file input\n    e.target.value = '';\n  };\n  const sendMessage = e => {\n    e.preventDefault();\n    if (!newMessage.trim() || !socket) {\n      console.log('ðŸ”´ Cannot send message - no socket or empty message');\n      return;\n    }\n    if (!socket.connected) {\n      setConnectionError('Not connected to chat server. Please try again.');\n      return;\n    }\n    const messageData = {\n      orderId: order.id,\n      senderId: user.id,\n      senderName: user.name,\n      message: newMessage.trim(),\n      messageType: 'text'\n    };\n    console.log('ðŸ“¤ Sending message:', messageData);\n    socket.emit('send_message', messageData);\n    setNewMessage('');\n  };\n  const handleTyping = () => {\n    if (socket && socket.connected) {\n      socket.emit('typing', {\n        orderId: order.id,\n        userId: user.id,\n        userName: user.name\n      });\n\n      // Stop typing after 1 second\n      setTimeout(() => {\n        if (socket && socket.connected) {\n          socket.emit('stop_typing', {\n            orderId: order.id,\n            userId: user.id\n          });\n        }\n      }, 1000);\n    }\n  };\n  const formatTime = timestamp => {\n    return new Date(timestamp).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n  const isMyMessage = message => {\n    return message.sender_id === user.id;\n  };\n  const getOtherPartyName = () => {\n    if (user.id === order.buyer_id) {\n      return order.seller_name;\n    } else {\n      return order.buyer_name;\n    }\n  };\n  const getFileIcon = mimetype => {\n    if (mimetype.startsWith('image/')) return 'ðŸ–¼ï¸';\n    if (mimetype === 'application/pdf') return 'ðŸ“„';\n    if (mimetype.includes('word') || mimetype.includes('document')) return 'ðŸ“';\n    if (mimetype === 'text/plain') return 'ðŸ“ƒ';\n    return 'ðŸ“Ž';\n  };\n  const formatFileSize = bytes => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-overlay\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-content\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading\",\n          children: \"Loading chat...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"modal-overlay\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-content chat-modal\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-title\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"\\uD83D\\uDCAC Trade Chat - Order #\", order.id]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"order-info\",\n            children: [\"Chatting with: \", getOtherPartyName()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"debug-info\",\n            children: /*#__PURE__*/_jsxDEV(\"small\", {\n              children: [\"Your ID: \", user.id, \" | Order ID: \", order.id, \" | Socket: \", socket !== null && socket !== void 0 && socket.connected ? 'ðŸŸ¢ Connected' : 'ðŸ”´ Disconnected']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"close-btn\",\n          onClick: onClose,\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }, this), connectionError && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: connectionError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-order-details\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"trade-summary\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: [order.amount, \" \", order.currency_from]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"arrow\",\n            children: \"\\u2192\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [order.total_price, \" \", order.currency_to]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"order-status\",\n          children: [\"Status: \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: `status-${order.status}`,\n            children: order.status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-messages\",\n        children: [messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-messages\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"No messages yet. Start the conversation!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 13\n        }, this) : messages.map(message => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `message ${isMyMessage(message) ? 'my-message' : 'other-message'}`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-content\",\n            children: [message.message_type === 'file' && message.file_data ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"file-message\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"file-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"file-icon\",\n                  children: getFileIcon(message.file_data.mimetype)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 299,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"file-details\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"file-name\",\n                    children: message.file_data.originalname\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 303,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"file-size\",\n                    children: formatFileSize(message.file_data.size)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 304,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 302,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 298,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                href: `http://localhost:50000${message.file_data.path}`,\n                target: \"_blank\",\n                rel: \"noopener noreferrer\",\n                className: \"download-btn\",\n                children: \"Download\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 307,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 21\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-text\",\n              children: message.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-time\",\n              children: [formatTime(message.created_at), !isMyMessage(message) && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"sender-name\",\n                children: [\" \\u2022 \", message.sender_name]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 322,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 17\n          }, this)\n        }, message.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 15\n        }, this)), typingUsers.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"typing-indicator\",\n          children: typingUsers.map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"typing-text\",\n            children: [user.userName, \" is typing...\"]\n          }, user.userId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 333,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: sendMessage,\n        className: \"chat-input-form\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            ref: fileInputRef,\n            onChange: handleFileSelect,\n            accept: \".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt\",\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"file-btn\",\n            onClick: () => {\n              var _fileInputRef$current;\n              return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n            },\n            disabled: uploading || !(socket !== null && socket !== void 0 && socket.connected),\n            children: uploading ? 'ðŸ“¤ Uploading...' : 'ðŸ“Ž'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 353,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: newMessage,\n            onChange: e => {\n              setNewMessage(e.target.value);\n              handleTyping();\n            },\n            placeholder: \"Type your message or attach file...\",\n            maxLength: \"500\",\n            disabled: !(socket !== null && socket !== void 0 && socket.connected)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 362,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            disabled: !newMessage.trim() || !(socket !== null && socket !== void 0 && socket.connected),\n            children: socket !== null && socket !== void 0 && socket.connected ? 'Send' : 'Connecting...'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"file-types-info\",\n          children: /*#__PURE__*/_jsxDEV(\"small\", {\n            children: \"Supported: Images (JPG, PNG, GIF), PDF, DOC, DOCX, TXT (Max 10MB)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 252,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatModal, \"sOQ+w02UZQQB3zc7bw/3GZNdLYY=\");\n_c = ChatModal;\nexport default ChatModal;\nvar _c;\n$RefreshReg$(_c, \"ChatModal\");","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","io","jsxDEV","_jsxDEV","ChatModal","order","user","onClose","_s","messages","setMessages","newMessage","setNewMessage","loading","setLoading","socket","setSocket","typingUsers","setTypingUsers","connectionError","setConnectionError","uploading","setUploading","fileInputRef","messagesEndRef","newSocket","transports","on","console","log","id","error","reason","loadMessages","connected","joinOrderRoom","message","prev","data","find","userId","filter","disconnect","emit","scrollToBottom","response","get","messagesWithFiles","map","file_data","JSON","parse","_messagesEndRef$curre","current","scrollIntoView","behavior","handleFileUpload","file","formData","FormData","append","name","uploadResponse","post","headers","messageData","orderId","senderId","senderName","messageType","alert","handleFileSelect","e","target","files","value","sendMessage","preventDefault","trim","handleTyping","userName","setTimeout","formatTime","timestamp","Date","toLocaleTimeString","hour","minute","isMyMessage","sender_id","getOtherPartyName","buyer_id","seller_name","buyer_name","getFileIcon","mimetype","startsWith","includes","formatFileSize","bytes","k","sizes","i","Math","floor","parseFloat","pow","toFixed","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","amount","currency_from","total_price","currency_to","status","length","message_type","originalname","size","href","path","rel","created_at","sender_name","ref","onSubmit","type","onChange","accept","style","display","_fileInputRef$current","click","disabled","placeholder","maxLength","_c","$RefreshReg$"],"sources":["/Users/mdkhalidhossain/CST/p2p-exchange/client/src/components/ChatModal.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport io from 'socket.io-client';\n\nconst ChatModal = ({ order, user, onClose }) => {\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [socket, setSocket] = useState(null);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [connectionError, setConnectionError] = useState('');\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef(null);\n  const messagesEndRef = useRef(null);\n\n  useEffect(() => {\n    // Initialize socket connection\n    const newSocket = io('http://localhost:50000', {\n      transports: ['websocket', 'polling']\n    });\n\n    newSocket.on('connect', () => {\n      console.log('ðŸ”µ Socket connected:', newSocket.id);\n      setConnectionError('');\n    });\n\n    newSocket.on('connect_error', (error) => {\n      console.error('ðŸ”´ Socket connection error:', error);\n      setConnectionError('Failed to connect to chat server');\n    });\n\n    newSocket.on('disconnect', (reason) => {\n      console.log('ðŸ”´ Socket disconnected:', reason);\n    });\n\n    setSocket(newSocket);\n\n    // Load chat messages\n    loadMessages();\n\n    // Join order room after connection is established\n    if (newSocket.connected) {\n      joinOrderRoom(newSocket);\n    } else {\n      newSocket.on('connect', () => {\n        joinOrderRoom(newSocket);\n      });\n    }\n\n    // Listen for new messages\n    newSocket.on('receive_message', (message) => {\n      console.log('ðŸ’¬ New message received:', message);\n      setMessages(prev => [...prev, message]);\n    });\n\n    // Listen for typing indicators\n    newSocket.on('user_typing', (data) => {\n      console.log('âŒ¨ï¸ User typing:', data);\n      setTypingUsers(prev => {\n        if (!prev.find(user => user.userId === data.userId)) {\n          return [...prev, data];\n        }\n        return prev;\n      });\n    });\n\n    newSocket.on('user_stop_typing', (data) => {\n      console.log('âŒ¨ï¸ User stopped typing:', data);\n      setTypingUsers(prev => prev.filter(user => user.userId !== data.userId));\n    });\n\n    return () => {\n      console.log('ðŸ”´ Cleaning up socket connection');\n      newSocket.disconnect();\n    };\n  }, [order.id]);\n\n  const joinOrderRoom = (socket) => {\n    console.log('ðŸŸ¡ Joining order room:', order.id);\n    socket.emit('join_order', order.id);\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, typingUsers]);\n\n  const loadMessages = async () => {\n    try {\n      console.log('ðŸŸ¡ Loading messages for order:', order.id);\n      const response = await axios.get(`http://localhost:50000/api/chat/messages/${order.id}`);\n      console.log('ðŸ“¨ Loaded messages:', response.data);\n      \n      // Parse file_data from JSON string\n      const messagesWithFiles = response.data.map(message => ({\n        ...message,\n        file_data: message.file_data ? JSON.parse(message.file_data) : null\n      }));\n      \n      setMessages(messagesWithFiles);\n    } catch (error) {\n      console.error('ðŸ”´ Error loading messages:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const handleFileUpload = async (file) => {\n    if (!file) return;\n\n    setUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      console.log('ðŸ“¤ Uploading file:', file.name);\n      \n      const uploadResponse = await axios.post('http://localhost:50000/api/upload', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n\n      console.log('ðŸŸ¢ File uploaded:', uploadResponse.data);\n\n      // Send file message via socket\n      if (socket && socket.connected) {\n        const messageData = {\n          orderId: order.id,\n          senderId: user.id,\n          senderName: user.name,\n          message: file.name,\n          messageType: 'file',\n          file: uploadResponse.data.file\n        };\n\n        console.log('ðŸ“¤ Sending file message:', messageData);\n        socket.emit('send_message', messageData);\n      }\n\n    } catch (error) {\n      console.error('ðŸ”´ File upload error:', error);\n      alert('Failed to upload file. Please try again.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleFileSelect = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n    // Reset file input\n    e.target.value = '';\n  };\n\n  const sendMessage = (e) => {\n    e.preventDefault();\n    if (!newMessage.trim() || !socket) {\n      console.log('ðŸ”´ Cannot send message - no socket or empty message');\n      return;\n    }\n\n    if (!socket.connected) {\n      setConnectionError('Not connected to chat server. Please try again.');\n      return;\n    }\n\n    const messageData = {\n      orderId: order.id,\n      senderId: user.id,\n      senderName: user.name,\n      message: newMessage.trim(),\n      messageType: 'text'\n    };\n\n    console.log('ðŸ“¤ Sending message:', messageData);\n    socket.emit('send_message', messageData);\n    setNewMessage('');\n  };\n\n  const handleTyping = () => {\n    if (socket && socket.connected) {\n      socket.emit('typing', {\n        orderId: order.id,\n        userId: user.id,\n        userName: user.name\n      });\n\n      // Stop typing after 1 second\n      setTimeout(() => {\n        if (socket && socket.connected) {\n          socket.emit('stop_typing', {\n            orderId: order.id,\n            userId: user.id\n          });\n        }\n      }, 1000);\n    }\n  };\n\n  const formatTime = (timestamp) => {\n    return new Date(timestamp).toLocaleTimeString([], { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const isMyMessage = (message) => {\n    return message.sender_id === user.id;\n  };\n\n  const getOtherPartyName = () => {\n    if (user.id === order.buyer_id) {\n      return order.seller_name;\n    } else {\n      return order.buyer_name;\n    }\n  };\n\n  const getFileIcon = (mimetype) => {\n    if (mimetype.startsWith('image/')) return 'ðŸ–¼ï¸';\n    if (mimetype === 'application/pdf') return 'ðŸ“„';\n    if (mimetype.includes('word') || mimetype.includes('document')) return 'ðŸ“';\n    if (mimetype === 'text/plain') return 'ðŸ“ƒ';\n    return 'ðŸ“Ž';\n  };\n\n  const formatFileSize = (bytes) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  if (loading) {\n    return (\n      <div className=\"modal-overlay\">\n        <div className=\"modal-content\">\n          <div className=\"loading\">Loading chat...</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"modal-overlay\">\n      <div className=\"modal-content chat-modal\">\n        <div className=\"chat-header\">\n          <div className=\"chat-title\">\n            <h3>ðŸ’¬ Trade Chat - Order #{order.id}</h3>\n            <div className=\"order-info\">\n              Chatting with: {getOtherPartyName()}\n            </div>\n            <div className=\"debug-info\">\n              <small>Your ID: {user.id} | Order ID: {order.id} | Socket: {socket?.connected ? 'ðŸŸ¢ Connected' : 'ðŸ”´ Disconnected'}</small>\n            </div>\n          </div>\n          <button className=\"close-btn\" onClick={onClose}>Ã—</button>\n        </div>\n\n        {connectionError && (\n          <div className=\"error-message\">\n            {connectionError}\n          </div>\n        )}\n\n        <div className=\"chat-order-details\">\n          <div className=\"trade-summary\">\n            <span>{order.amount} {order.currency_from}</span>\n            <span className=\"arrow\">â†’</span>\n            <span>{order.total_price} {order.currency_to}</span>\n          </div>\n          <div className=\"order-status\">\n            Status: <span className={`status-${order.status}`}>{order.status}</span>\n          </div>\n        </div>\n\n        <div className=\"chat-messages\">\n          {messages.length === 0 ? (\n            <div className=\"no-messages\">\n              <p>No messages yet. Start the conversation!</p>\n            </div>\n          ) : (\n            messages.map((message) => (\n              <div\n                key={message.id}\n                className={`message ${isMyMessage(message) ? 'my-message' : 'other-message'}`}\n              >\n                <div className=\"message-content\">\n                  {message.message_type === 'file' && message.file_data ? (\n                    <div className=\"file-message\">\n                      <div className=\"file-info\">\n                        <span className=\"file-icon\">\n                          {getFileIcon(message.file_data.mimetype)}\n                        </span>\n                        <div className=\"file-details\">\n                          <div className=\"file-name\">{message.file_data.originalname}</div>\n                          <div className=\"file-size\">{formatFileSize(message.file_data.size)}</div>\n                        </div>\n                      </div>\n                      <a \n                        href={`http://localhost:50000${message.file_data.path}`} \n                        target=\"_blank\" \n                        rel=\"noopener noreferrer\"\n                        className=\"download-btn\"\n                      >\n                        Download\n                      </a>\n                    </div>\n                  ) : (\n                    <div className=\"message-text\">{message.message}</div>\n                  )}\n                  <div className=\"message-time\">\n                    {formatTime(message.created_at)}\n                    {!isMyMessage(message) && (\n                      <span className=\"sender-name\"> â€¢ {message.sender_name}</span>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n          \n          {typingUsers.length > 0 && (\n            <div className=\"typing-indicator\">\n              {typingUsers.map(user => (\n                <div key={user.userId} className=\"typing-text\">\n                  {user.userName} is typing...\n                </div>\n              ))}\n            </div>\n          )}\n          \n          <div ref={messagesEndRef} />\n        </div>\n\n        <form onSubmit={sendMessage} className=\"chat-input-form\">\n          <div className=\"input-group\">\n            <input\n              type=\"file\"\n              ref={fileInputRef}\n              onChange={handleFileSelect}\n              accept=\".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.txt\"\n              style={{ display: 'none' }}\n            />\n            \n            <button \n              type=\"button\" \n              className=\"file-btn\"\n              onClick={() => fileInputRef.current?.click()}\n              disabled={uploading || !socket?.connected}\n            >\n              {uploading ? 'ðŸ“¤ Uploading...' : 'ðŸ“Ž'}\n            </button>\n            \n            <input\n              type=\"text\"\n              value={newMessage}\n              onChange={(e) => {\n                setNewMessage(e.target.value);\n                handleTyping();\n              }}\n              placeholder=\"Type your message or attach file...\"\n              maxLength=\"500\"\n              disabled={!socket?.connected}\n            />\n            \n            <button \n              type=\"submit\" \n              disabled={!newMessage.trim() || !socket?.connected}\n            >\n              {socket?.connected ? 'Send' : 'Connecting...'}\n            </button>\n          </div>\n          \n          <div className=\"file-types-info\">\n            <small>Supported: Images (JPG, PNG, GIF), PDF, DOC, DOCX, TXT (Max 10MB)</small>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}